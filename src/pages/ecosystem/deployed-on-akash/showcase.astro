---
import ProjectCard from "@/components/ecosystem-pages/project-card.astro";
import Layout from "@/layouts/layout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

import Categories from "@/components/ecosystem-pages/categories.astro";
import TopHeader from "@/components/ecosystem-pages/top-header.astro";
import TopMargin from "@/components/ui/top-margin.astro";
import { getPriorityIndex } from "@/utils/sequences/deployedOnAkash";

type Project = CollectionEntry<"Ecosystem_Page">;

const data = await getCollection("Ecosystem_Page");

const sortProjects = (projects: Project[]) =>
  projects.sort((a, b) => {
    const priorityDiff =
      getPriorityIndex(a.data.projectTitle) -
      getPriorityIndex(b.data.projectTitle);
    if (priorityDiff !== 0) return priorityDiff;

    return (
      new Date(b.data.pubDate).getTime() - new Date(a.data.pubDate).getTime()
    );
  });

const cards = sortProjects(
  data.filter((project) => project.data.category === "deployed_on_akash"),
);
const projects = sortProjects(
  data.filter((project) => project.data.showcase === true),
);

const tags: string[] = Array.from(
  new Set(
    cards.flatMap((project) =>
      project.data.tags.map((tag) => tag.toLowerCase()),
    ),
  ),
);
---

<Layout title="Showcase" image="/meta-images/ecosystem.png">
  <TopMargin>
    <TopHeader tags={tags} />
  </TopMargin>

  <div
    class="container mt-10 flex justify-between lg:gap-x-[20px] xl:gap-x-[48px]"
  >
    <Categories tags={tags} />

    <div>
      <h3
        class="text-[20px] font-bold leading-[28px] md:text-2lg md:leading-[48px]"
      >
        Showcase
      </h3>

      <div
        class="mt-4 grid flex-shrink-0 grid-cols-1 gap-y-[24px] sm:grid-cols-2 sm:gap-x-8 md:gap-y-8 lg:grid-cols-3 lg:gap-x-[36px] lg:gap-y-[32px]"
      >
        {
          projects?.map((project: Project, i: number) => (
            <ProjectCard
              key={i}
              title={project.data.projectTitle}
              description={project.data.description}
              image={project.data.projectImage}
              button={project.data.ctaButton}
              githubLink={project.data.githubLink}
              twitterLink={project.data.twitterLink}
              websiteLink={project.data.websiteLink}
              discordLink={project.data.discordLink}
            />
          ))
        }
      </div>
    </div>
  </div>
</Layout>
